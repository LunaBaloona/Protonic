import { Button, LineEdit, VerticalBox, HorizontalBox, ScrollView, CheckBox } from "std-widgets.slint";

export component AppWindow inherits Window {
    title: "Protonic v0.2.1";
    icon: @image-url("icon.png");
    min-width: 500px;
    min-height: 620px;

    in property <[string]> game_names: [];
    in-out property <string> app_id: "";
    in-out property <string> search_text;
    in-out property <string> exe1_path: "";
    in-out property <string> exe2_path: "";
    in-out property <bool> auto_configure: true;
    in-out property <string> launch_options_status: "";

    callback run_protonhax(string);
    callback game_selected(string);
    callback search_edited(string);
    callback browse_exe1();
    callback browse_exe2();
    callback clear_exe1();
    callback clear_exe2();
    callback auto_configure_toggled(bool);

    VerticalBox {
        padding: 20px;
        spacing: 10px;

        Text { text: "Search & Select Game:"; font-size: 14px; }

        LineEdit {
            placeholder-text: "Type to search...";
            text <=> root.search_text;
            edited(text) => {
                root.search_edited(text);
            }
        }

        Rectangle {
            background: #2a2a2a;
            border-radius: 4px;
            height: 160px;
            ScrollView {
                VerticalBox {
                    padding: 5px;
                    alignment: start;
                    for name in root.game_names : Button {
                        text: name;
                        clicked => {
                            root.game_selected(name);
                            root.search_text = name;
                        }
                    }
                }
            }
        }

        // Executable 1 Section
        Text { text: "Program or .exe file 1:"; font-size: 14px; }
        HorizontalBox {
            spacing: 8px;
            Rectangle {
                background: #2a2a2a;
                border-radius: 4px;
                horizontal-stretch: 1;
                HorizontalBox {
                    padding-left: 8px;
                    padding-right: 8px;
                    Text {
                        text: root.exe1_path == "" ? "No file selected" : root.exe1_path;
                        color: root.exe1_path == "" ? #888888 : #ffffff;
                        font-size: 12px;
                        overflow: elide;
                        vertical-alignment: center;
                    }
                }
            }
            Button {
                text: "Browse";
                clicked => { root.browse_exe1(); }
            }
            Button {
                text: "Clear";
                enabled: root.exe1_path != "";
                clicked => { root.clear_exe1(); }
            }
        }

        // Executable 2 Section
        Text { text: "Program or .exe file (Optional):"; font-size: 14px; }
        HorizontalBox {
            spacing: 8px;
            Rectangle {
                background: #2a2a2a;
                border-radius: 4px;
                horizontal-stretch: 1;
                HorizontalBox {
                    padding-left: 8px;
                    padding-right: 8px;
                    Text {
                        text: root.exe2_path == "" ? "No file selected" : root.exe2_path;
                        color: root.exe2_path == "" ? #888888 : #ffffff;
                        font-size: 12px;
                        overflow: elide;
                        vertical-alignment: center;
                    }
                }
            }
            Button {
                text: "Browse";
                clicked => { root.browse_exe2(); }
            }
            Button {
                text: "Clear";
                enabled: root.exe2_path != "";
                clicked => { root.clear_exe2(); }
            }
        }

        // Launch Options Section
        VerticalBox {
            padding: 0;
            spacing: 8px;

            HorizontalBox {
                spacing: 8px;
                alignment: start;
                CheckBox {
                    text: "Auto-configure launch options";
                    checked <=> root.auto_configure;
                    toggled => {
                        root.auto_configure_toggled(root.auto_configure);
                    }
                }
            }

            // Show manual instruction to the user only if auto-configure is off
            if !root.auto_configure : VerticalBox {
                padding: 0;
                spacing: 5px;
                Text {
                    text: "Add this line to the game's Launch Options in Steam:";
                    font-size: 11px;
                    wrap: word-wrap;
                }
                LineEdit {
                    text: "protonhax init %COMMAND%";
                    read-only: true;
                }
            }

            // Show status when auto-config is on
            if root.auto_configure && root.launch_options_status != "" : Text {
                text: root.launch_options_status;
                font-size: 11px;
                color: #888888;
                wrap: word-wrap;
            }
        }

        Text {
            text: "Press Launch, then press F1 at the game's menu to run your executable(s)";
            font-size: 11px;
            color: #3498db;
            wrap: word-wrap;
            horizontal-alignment: center;
        }

        Button {
            text: "Launch";
            primary: true;
            enabled: root.app_id != "" && root.exe1_path != "";
            clicked => {
                root.run_protonhax(root.app_id);
            }
        }
    }
}
